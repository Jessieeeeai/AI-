# ✅ RunPod 部署检查清单

## 🎯 部署前准备

### 账号和充值
- [ ] RunPod账号已注册
- [ ] 账号已实名（如需要）
- [ ] 已充值至少 $20
- [ ] 已设置余额预警（建议$10）

### 代码准备
- [ ] 代码已在本地测试通过
- [ ] 已创建GitHub仓库
- [ ] 代码已推送到GitHub
- [ ] `.env.example` 已配置正确
- [ ] `deploy_runpod.sh` 脚本已准备好

### 文档检查
- [ ] 已阅读 `RUNPOD_QUICKSTART.md`
- [ ] 已阅读 `RUNPOD_DEPLOYMENT.md`
- [ ] 已了解费用（参考 `RUNPOD_PRICING.md`）
- [ ] 已准备好测试账号信息

---

## 🚀 RunPod配置

### GPU Pod创建
- [ ] GPU类型：RTX 3090 或 RTX 4090
- [ ] 显存：≥ 24GB
- [ ] 模板：runpod/pytorch:2.1.0-py3.10-cuda11.8.0-devel
- [ ] Container Disk：50GB
- [ ] Volume Disk：100GB
- [ ] 已勾选 "Persistent Volume"
- [ ] 暴露端口：3001, 5000, 8188
- [ ] 实例类型：On-Demand（稳定）或 Spot（便宜）

### Pod启动验证
- [ ] Pod状态显示 "Running"
- [ ] 可以打开 Web Terminal
- [ ] 或可以通过SSH连接
- [ ] `nvidia-smi` 显示GPU信息正常

---

## 💻 部署执行

### 环境配置
- [ ] 已连接到Pod（Web Terminal或SSH）
- [ ] 当前目录在 `/workspace`
- [ ] 网络连接正常（可以访问GitHub）

### 代码部署
- [ ] 成功克隆Git仓库
- [ ] `deploy_runpod.sh` 脚本有执行权限
- [ ] 执行部署脚本
- [ ] 脚本运行无错误
- [ ] Node.js已安装（v18+）
- [ ] Python3已安装
- [ ] PM2已安装
- [ ] 所有npm依赖已安装
- [ ] 前端已构建（client/dist存在）

### 模型下载
- [ ] `/workspace/models` 目录已创建
- [ ] Wav2Vec模型已下载
- [ ] （可选）IndexTTS2模型已下载
- [ ] （可选）Wan2.1视频模型已下载

### 数据库初始化
- [ ] `database/videoai.db` 文件已创建
- [ ] 数据库表已创建
- [ ] 测试账号已创建
- [ ] VIP账号（1000积分）存在

### 环境变量
- [ ] `.env` 文件已创建
- [ ] `NODE_ENV=production`
- [ ] `PORT=3001`
- [ ] 数据库路径配置正确
- [ ] 上传目录配置正确
- [ ] JWT_SECRET已设置

---

## 🔄 服务启动

### PM2服务
- [ ] `pm2 start ecosystem.config.cjs` 执行成功
- [ ] `pm2 status` 显示所有服务
- [ ] videoai-backend 状态为 "online"
- [ ] mock-indextts2 状态为 "online"
- [ ] mock-comfyui 状态为 "online"
- [ ] 无服务显示 "errored" 或 "stopped"

### 日志检查
- [ ] `pm2 logs` 无严重错误
- [ ] backend日志显示 "Server running on port 3001"
- [ ] TTS服务日志显示启动成功
- [ ] ComfyUI服务日志显示启动成功

### 端口检查
- [ ] `curl http://localhost:3001/health` 返回200
- [ ] `curl http://localhost:5000/health` 返回200
- [ ] `curl http://localhost:8188/health` 返回200

### GPU检查
- [ ] `nvidia-smi` 显示GPU被使用
- [ ] GPU内存占用正常（不超过23GB）
- [ ] GPU温度正常（< 80°C）

---

## 🌐 网络访问

### RunPod URL
- [ ] 在RunPod控制台找到公网地址
- [ ] 格式类似：`https://xxx-3001.proxy.runpod.net`
- [ ] 复制URL

### 网站访问
- [ ] 在浏览器打开公网地址
- [ ] 网站首页正常显示
- [ ] 无404或500错误
- [ ] 静态资源加载正常（图片、CSS、JS）

### 功能测试
- [ ] 注册功能正常
- [ ] 登录功能正常
- [ ] 可以使用测试账号登录
- [ ] VIP账号显示1000积分
- [ ] 上传声音文件成功
- [ ] 声音预览功能正常
- [ ] 上传模板文件成功
- [ ] 模板显示正常

---

## 🧪 完整功能测试

### 步骤1：输入文本
- [ ] 可以输入文本
- [ ] 文本保存正常
- [ ] 下一步按钮可用

### 步骤2：声音设置
- [ ] 系统声音预览正常
- [ ] 可以上传声音文件（WAV/MP3/M4A）
- [ ] 上传后显示声音信息
- [ ] 声音克隆预览功能正常（调用TTS）
- [ ] 情绪滑块调整正常
- [ ] 语速、音调、音量调整正常

### 步骤3：模板选择
- [ ] 系统模板显示正常
- [ ] 自定义模板显示正常
- [ ] 可以上传新模板
- [ ] 模板预览正常

### 步骤4：生成视频
- [ ] 点击生成按钮
- [ ] 显示生成中状态
- [ ] 进度条更新
- [ ] 积分正确扣除
- [ ] （Mock模式）显示测试视频
- [ ] 可以下载生成的视频
- [ ] 历史记录中显示

### 历史记录
- [ ] 历史页面显示所有生成记录
- [ ] 可以查看详情
- [ ] 可以重新生成
- [ ] 可以删除记录

---

## 🔐 安全检查

### 认证和授权
- [ ] 未登录无法访问创建页面
- [ ] JWT token正常工作
- [ ] 登出功能正常
- [ ] 密码不会明文显示

### 文件上传
- [ ] 文件大小限制生效
- [ ] 文件类型验证生效
- [ ] 上传的文件保存在正确位置
- [ ] 文件URL可以访问

### 数据隔离
- [ ] 用户只能看到自己的声音
- [ ] 用户只能看到自己的模板
- [ ] 用户只能看到自己的历史

---

## 📊 性能监控

### 资源使用
- [ ] CPU使用率正常（< 80%）
- [ ] 内存使用正常（< 90%）
- [ ] GPU使用正常（< 95%）
- [ ] 磁盘空间充足（> 10GB剩余）

### 响应时间
- [ ] 页面加载 < 3秒
- [ ] API响应 < 2秒
- [ ] 文件上传 < 10秒
- [ ] （Mock）视频生成 < 30秒

### 日志轮转
- [ ] 日志文件大小合理（< 100MB）
- [ ] 旧日志自动清理
- [ ] PM2日志轮转已配置

---

## 💾 数据备份

### 数据库备份
- [ ] 手动备份数据库
- [ ] 备份文件保存在安全位置
- [ ] 测试恢复备份

### 文件备份
- [ ] 上传的声音文件已备份
- [ ] 上传的模板文件已备份
- [ ] 生成的视频已备份（可选）

### 备份策略
- [ ] 设置定时备份（cron）
- [ ] 备份保留策略（如保留30天）

---

## 🔧 维护配置

### PM2持久化
- [ ] `pm2 save` 已执行
- [ ] `pm2 startup` 已配置
- [ ] 重启后服务自动启动

### 监控设置
- [ ] PM2 monit可以查看实时状态
- [ ] 日志可以正常查看
- [ ] 错误日志单独记录

### 更新流程
- [ ] 知道如何 git pull 更新代码
- [ ] 知道如何重启服务
- [ ] 知道如何查看日志排查问题

---

## 📞 故障处理

### 常见问题解决方案
- [ ] 服务启动失败 → 查看 `pm2 logs --err`
- [ ] 端口占用 → `pm2 delete all && pm2 start`
- [ ] 数据库错误 → 重新初始化
- [ ] GPU内存不足 → 重启服务释放
- [ ] 网站无法访问 → 检查端口配置

### 联系支持
- [ ] RunPod支持：support@runpod.io
- [ ] Discord社区：https://discord.gg/runpod
- [ ] 文档：https://docs.runpod.io/

---

## 🎉 部署完成确认

### 最终检查
- [ ] 所有上述检查项已完成
- [ ] 网站可以正常访问
- [ ] 测试账号可以登录
- [ ] 核心功能正常工作
- [ ] 无严重错误日志
- [ ] 性能指标正常
- [ ] 已设置监控和备份

### 文档保存
- [ ] 记录RunPod URL
- [ ] 记录测试账号信息
- [ ] 记录重要配置
- [ ] 保存部署日期和版本

### 交接准备（如需要）
- [ ] 准备操作手册
- [ ] 准备维护文档
- [ ] 准备故障处理指南

---

## 📈 下一步

### 优化方向
- [ ] 从Mock切换到真实TTS模型
- [ ] 从Mock切换到真实ComfyUI
- [ ] 配置Nginx反向代理
- [ ] 绑定自定义域名
- [ ] 配置SSL证书
- [ ] 设置CDN加速
- [ ] 优化数据库查询
- [ ] 添加Redis缓存

### 功能扩展
- [ ] 添加用户充值功能
- [ ] 添加更多声音模板
- [ ] 添加更多视频模板
- [ ] 添加批量生成功能
- [ ] 添加视频编辑功能
- [ ] 添加社交分享功能

### 商业化准备
- [ ] 接入支付系统
- [ ] 添加订阅套餐
- [ ] 添加API接口
- [ ] 添加使用统计
- [ ] 添加邀请奖励
- [ ] 准备用户协议和隐私政策

---

**祝您部署顺利！** 🚀

如有任何问题，请参考 `RUNPOD_DEPLOYMENT.md` 或联系技术支持。

---

**部署日期**: _____________

**部署人员**: _____________

**RunPod URL**: _____________

**版本号**: _____________

**备注**: _____________
