# ğŸ¬ VideoAI Pro - ä¼˜åŒ–åçš„äº§å“è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ›´æ–°è¯´æ˜

**ä¼˜åŒ–ç‰ˆæœ¬**: v2.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-20
**æ ¸å¿ƒä¼˜åŒ–**: æ”¹è¿›ç”¨æˆ·åˆ›ä½œæµç¨‹ï¼Œå¢åŠ AIæ–‡æ¡ˆä¼˜åŒ–å’Œé•¿è§†é¢‘åˆ†æ®µå¤„ç†

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹å˜æ›´

### åŸæµç¨‹ï¼ˆv1.0ï¼‰
```
Step 1: è¾“å…¥æ–‡æœ¬ 
  â†’ Step 2: å£°éŸ³è®¾ç½® 
  â†’ Step 3: æ¨¡æ¿é€‰æ‹© 
  â†’ Step 4: ç¡®è®¤ç”Ÿæˆ
```

### ä¼˜åŒ–åæµç¨‹ï¼ˆv2.0ï¼‰
```
Step 1: è¾“å…¥æ–‡æ¡ˆ + AIä¼˜åŒ–
  â†’ Step 2: è¯•å¬ç¡®è®¤ï¼ˆç”ŸæˆéŸ³é¢‘ç‰‡æ®µé¢„è§ˆï¼‰
  â†’ Step 3: å£°éŸ³å…‹éš†æˆ–é€‰æ‹©é¢„åˆ¶å£°éŸ³
  â†’ Step 4: é€‰æ‹©è§†é¢‘æ¨¡æ¿
  â†’ Step 5: é•¿è§†é¢‘å¤„ç†ï¼ˆè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†æ®µï¼‰
  â†’ Step 6: ç¡®è®¤ç”Ÿæˆ
```

---

## ğŸ“ è¯¦ç»†æµç¨‹è®¾è®¡

### Step 1: è¾“å…¥æ–‡æ¡ˆ + AIæ™ºèƒ½ä¼˜åŒ–

#### 1.1 é¡µé¢å¸ƒå±€

**å·¦ä¾§åŒºåŸŸï¼ˆåŸå§‹æ–‡æ¡ˆè¾“å…¥ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ ç²˜è´´æ‚¨çš„åŸå§‹æ–‡æ¡ˆ                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  [å¤§å‹æ–‡æœ¬æ¡† Textarea]                   â”‚
â”‚  - placeholder: "ç²˜è´´æ‚¨çš„æ–‡ç« æˆ–æ–‡æ¡ˆ..."   â”‚
â”‚  - è‡ªåŠ¨é«˜åº¦è°ƒæ•´                          â”‚
â”‚  - æœ€å¤§10000å­—ç¬¦                         â”‚
â”‚                                         â”‚
â”‚  å­—ç¬¦æ•°: 1250/10000                      â”‚
â”‚                                         â”‚
â”‚  [æ¸…ç©º] [AIä¼˜åŒ–æ–‡æ¡ˆ] â† ä¸»æŒ‰é’®            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å³ä¾§åŒºåŸŸï¼ˆAIä¼˜åŒ–åçš„å£æ’­ç¨¿ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ¨ AIä¼˜åŒ–åçš„å£æ’­ç¨¿                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  [æ˜¾ç¤ºåŒºåŸŸ]                              â”‚
â”‚  - ä¼˜åŒ–å®Œæˆå‰æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º               â”‚
â”‚  - ä¼˜åŒ–å®Œæˆåæ˜¾ç¤ºç»“æœ                    â”‚
â”‚  - å¯ç¼–è¾‘ï¼ˆTextareaï¼‰                    â”‚
â”‚                                         â”‚
â”‚  ä¼˜åŒ–è¯´æ˜ï¼š                              â”‚
â”‚  âœ“ å·²è½¬æ¢ä¸ºå£è¯­åŒ–è¡¨è¾¾                    â”‚
â”‚  âœ“ æ·»åŠ äº†æ°å½“çš„è¯­æ°”è¯                    â”‚
â”‚  âœ“ æ•°å­—å·²è½¬æ¢ä¸ºä¸­æ–‡                      â”‚
â”‚  âœ“ æ ‡ç‚¹ç¬¦å·å·²ç®€åŒ–                       â”‚
â”‚                                         â”‚
â”‚  å­—ç¬¦æ•°: 980/10000                       â”‚
â”‚  é¢„è®¡æ—¶é•¿: 3.3åˆ†é’Ÿ                       â”‚
â”‚                                         â”‚
â”‚  [æ‰‹åŠ¨ç¼–è¾‘] [é‡æ–°ä¼˜åŒ–] [ä¸‹ä¸€æ­¥]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 AIæ–‡æ¡ˆä¼˜åŒ–è§„åˆ™

**è°ƒç”¨æ–¹å¼**: 
- ç”¨æˆ·ç‚¹å‡»"AIä¼˜åŒ–æ–‡æ¡ˆ"æŒ‰é’®
- å‰ç«¯è°ƒç”¨ `/api/optimize/script`
- åç«¯è°ƒç”¨AIæœåŠ¡ï¼ˆOpenAI/Claude/æœ¬åœ°æ¨¡å‹ï¼‰

**APIæ¥å£è®¾è®¡**:

```javascript
POST /api/optimize/script

è¯·æ±‚ä½“ï¼š
{
  "originalText": "ç”¨æˆ·è¾“å…¥çš„åŸå§‹æ–‡æ¡ˆ",
  "style": "humorous" // å¯é€‰ï¼šhumorous(å¹½é»˜), professional(ä¸“ä¸š), casual(è½»æ¾)
}

å“åº”ï¼š
{
  "success": true,
  "optimizedText": "ä¼˜åŒ–åçš„å£æ’­ç¨¿",
  "changes": {
    "addedExclamations": 15,  // æ·»åŠ çš„è¯­æ°”è¯æ•°é‡
    "convertedNumbers": 8,     // è½¬æ¢çš„æ•°å­—æ•°é‡
    "simplifiedPunctuation": 23, // ç®€åŒ–çš„æ ‡ç‚¹ç¬¦å·
    "originalLength": 1250,    // åŸå§‹å­—ç¬¦æ•°
    "optimizedLength": 980     // ä¼˜åŒ–åå­—ç¬¦æ•°
  },
  "warnings": [
    "æ£€æµ‹åˆ°è´Ÿé¢æ¶ˆæ¯ï¼Œå·²ä½¿ç”¨æ°å½“çš„è´Ÿé¢è¯­æ°”è¯"
  ]
}
```

**ä¼˜åŒ–è§„åˆ™è¯¦ç»†è¯´æ˜**:

**è§„åˆ™1: è¯­è¨€é£æ ¼è½¬æ¢**
- ä¹¦é¢è¯­ â†’ å£è¯­åŒ–
  - "æ ¹æ®" â†’ "æŒ‰ç…§"
  - "è¿›è¡Œ" â†’ "åš"
  - "å®æ–½" â†’ "æ"
  - "æ˜¾è‘—" â†’ "æ˜æ˜¾"
- åˆ é™¤å†—ä½™è¯æ±‡
  - "çš„è¯"ã€"æ¥è¯´"ã€"è€Œè¨€"
- ç®€åŒ–é•¿å¥
  - è¶…è¿‡30å­—çš„å¥å­æ‹†åˆ†ä¸º2-3ä¸ªçŸ­å¥

**è§„åˆ™2: æ ‡ç‚¹ç¬¦å·å¤„ç†**
- ä¿ç•™: å¥å·(ã€‚)ã€æ„Ÿå¹å·(ï¼)ã€é—®å·(ï¼Ÿ)
- åˆ é™¤/æ›¿æ¢:
  - é€—å·(ï¼Œ) â†’ å¥å·(ã€‚) æˆ–åˆ é™¤
  - é¡¿å·(ã€) â†’ åˆ é™¤æˆ–æ”¹ä¸º"å’Œ"
  - åˆ†å·(ï¼›) â†’ å¥å·(ã€‚)
  - å†’å·(ï¼š) â†’ åˆ é™¤
  - å¼•å·("") â†’ åˆ é™¤
  - ç ´æŠ˜å·(â€”â€”) â†’ åˆ é™¤
  - çœç•¥å·(â€¦â€¦) â†’ åˆ é™¤
  - ä¹¦åå·(ã€Šã€‹) â†’ åˆ é™¤

**è§„åˆ™3: æ•°å­—è½¬æ¢**
```javascript
const numberMap = {
  // é˜¿æ‹‰ä¼¯æ•°å­— â†’ ä¸­æ–‡å£è¯­åŒ–
  '8000000': 'å…«ç™¾ä¸‡',
  '80000': 'å…«ä¸‡',
  '8000': 'å…«åƒ',
  '800': 'å…«ç™¾',
  '80': 'å…«å',
  '8': 'å…«',
  
  // å°æ•°å¤„ç†
  '3.14': 'ä¸‰ç‚¹ä¸€å››',
  '0.5': 'é›¶ç‚¹äº”',
  
  // ç™¾åˆ†æ¯”
  '50%': 'ç™¾åˆ†ä¹‹äº”å',
  '3.5%': 'ç™¾åˆ†ä¹‹ä¸‰ç‚¹äº”',
  
  // æ—¶é—´
  '2025å¹´': 'äºŒé›¶äºŒäº”å¹´',
  '11æœˆ20æ—¥': 'åä¸€æœˆäºŒåå·',
  
  // é‡‘é¢
  '$100': 'ä¸€ç™¾ç¾å…ƒ',
  'Â¥500': 'äº”ç™¾å—',
  '500å…ƒ': 'äº”ç™¾å—'
};

// ç‰¹æ®Šè§„åˆ™ï¼š
// - ä¿ç•™æ•´æ•°å•ä½ï¼š1ä¸‡ã€10ä¸‡ã€100ä¸‡ã€1äº¿
// - ç”µè¯å·ç ä¿æŒåŸæ ·
// - èº«ä»½è¯å·ä¿æŒåŸæ ·
```

**è§„åˆ™4: è‹±æ–‡ä¿æŒåŸæ ·**
```javascript
// ä¿æŒä¸å˜çš„è‹±æ–‡å†…å®¹ï¼š
const keepEnglish = [
  // å“ç‰Œå
  'iPhone', 'Tesla', 'ChatGPT', 'OpenAI',
  
  // ä¸“ä¸šæœ¯è¯­
  'AI', 'GPU', 'CPU', 'API', 'UI', 'UX',
  'Machine Learning', 'Deep Learning',
  
  // ç¼©å†™
  'CEO', 'CTO', 'CFO', 'HR', 'PR',
  
  // å•ä½
  'GB', 'MB', 'KB', 'TB',
  'km', 'kg', 'ml'
];

// ä¸ç¿»è¯‘ï¼Œä½†å¯ä»¥æ·»åŠ ä¸­æ–‡è§£é‡Šï¼š
// "ChatGPT" â†’ "ChatGPTèŠå¤©æœºå™¨äºº"
// "Tesla" â†’ "ç‰¹æ–¯æ‹‰Tesla"
```

**è§„åˆ™5: è¯­æ°”è¯æ·»åŠ ï¼ˆæ ¸å¿ƒè§„åˆ™ï¼‰**

**A. æƒ…æ„Ÿåˆ†ææµç¨‹**:
```javascript
// 1. å…ˆåˆ†ææ•´ä½“æƒ…æ„ŸåŸºè°ƒ
const analyzeSentiment = (text) => {
  // ä½¿ç”¨æƒ…æ„Ÿåˆ†ææ¨¡å‹ï¼ˆæˆ–å…³é”®è¯åŒ¹é…ï¼‰
  const positiveKeywords = ['ä¸Šæ¶¨', 'å¢é•¿', 'æˆåŠŸ', 'çªç ´', 'åˆ›æ–°', 'å–œæŠ¥'];
  const negativeKeywords = ['ä¸‹è·Œ', 'æš´è·Œ', 'å¤±è´¥', 'å´©ç›˜', 'å±æœº', 'æŸå¤±'];
  const shockKeywords = ['çªç„¶', 'æ„å¤–', 'æƒŠäºº', 'å²æ— å‰ä¾‹', 'éœ‡æƒŠ'];
  
  // è¿”å›æƒ…æ„Ÿç±»å‹å’Œå¼ºåº¦
  return {
    type: 'positive' | 'negative' | 'neutral' | 'shock',
    intensity: 0-100
  };
};

// 2. æ ¹æ®æƒ…æ„Ÿé€‰æ‹©è¯­æ°”è¯
const selectExclamation = (sentiment, context) => {
  if (sentiment.type === 'positive') {
    if (context.includes('æš´æ¶¨') || context.includes('é£™å‡')) {
      return ['å“‡å¡', 'ç‰›é€¼', 'å¤ªçŒ›äº†'][random()];
    } else if (context.includes('æˆåŠŸ')) {
      return ['å¤ªæ£’äº†', 'ç»™åŠ›', 'èµ'][random()];
    }
  } else if (sentiment.type === 'negative') {
    if (context.includes('æš´è·Œ') || context.includes('å´©ç›˜')) {
      return ['å§æ§½', 'æƒ¨äº†', 'å®Œè›‹äº†'][random()];
    } else if (context.includes('å¤±è´¥')) {
      return ['ç³Ÿç³•', 'è¦å‘½äº†', 'å´©äº†'][random()];
    }
  } else if (sentiment.type === 'shock') {
    return ['å¤©å“ª', 'å¦ˆè€¶', 'ä¸ä¼šå§', 'ç¦»è°±'][random()];
  }
  
  return null; // ä¸­æ€§å†…å®¹å¯ä»¥ä¸åŠ è¯­æ°”è¯
};
```

**B. è¯­æ°”è¯åº“å®Œæ•´åˆ—è¡¨**:
```javascript
const exclamations = {
  // æ­£é¢æ¶ˆæ¯ï¼ˆä¸Šæ¶¨ã€æˆåŠŸã€å¥½æ¶ˆæ¯ï¼‰
  positive: {
    strong: ['å“‡å¡', 'ç‰›é€¼', 'å¤ªçŒ›äº†', 'ç‚¸äº†'],      // å¼ºçƒˆæ­£é¢
    medium: ['å¤ªæ£’äº†', 'ç»™åŠ›', 'èµ', 'å‰å®³äº†'],      // ä¸­ç­‰æ­£é¢
    mild: ['ä¸é”™', 'å¯ä»¥', 'æŒºå¥½']                   // è½»å¾®æ­£é¢
  },
  
  // è´Ÿé¢æ¶ˆæ¯ï¼ˆä¸‹è·Œã€å¤±è´¥ã€åæ¶ˆæ¯ï¼‰
  negative: {
    strong: ['å§æ§½', 'å®Œè›‹äº†', 'æƒ¨äº†', 'å´©äº†'],      // å¼ºçƒˆè´Ÿé¢
    medium: ['ç³Ÿç³•', 'è¦å‘½äº†', 'é­äº†'],              // ä¸­ç­‰è´Ÿé¢
    mild: ['ä¸å¤ªå¥½', 'éº»çƒ¦äº†']                       // è½»å¾®è´Ÿé¢
  },
  
  // éœ‡æƒŠæ¶ˆæ¯ï¼ˆæ„å¤–ã€åè½¬ã€ç½•è§ï¼‰
  shock: ['å¤©å“ª', 'å¦ˆè€¶', 'ä¸ä¼šå§', 'ç¦»è°±', 'å¤ªå¤¸å¼ äº†', 'ç»äº†'],
  
  // ç–‘æƒ‘å›°æƒ‘
  confused: ['å•Š', 'å—¯', 'å’¦', 'å¥‡æ€ª', 'ä»€ä¹ˆæƒ…å†µ', 'æ€ä¹ˆå›äº‹'],
  
  // è½»æ¾å¹½é»˜
  humorous: ['å“ˆå“ˆ', 'å˜¿å˜¿', 'è®¨åŒ', 'å“¼', 'å¥½ç©'],
  
  // å¼ºè°ƒé‡ç‚¹
  emphasis: ['æ³¨æ„äº†', 'å¬å¥½äº†', 'é‡ç‚¹æ¥äº†', 'å…³é”®æ˜¯', 'åˆ’é‡ç‚¹']
};
```

**C. è¯­æ°”è¯æ’å…¥ä½ç½®è§„åˆ™**:
```javascript
// æ’å…¥æ—¶æœºï¼š
1. å…³é”®æ•°æ®å‰ï¼š
   "å“‡å¡ï¼æ¯”ç‰¹å¸çªç ´10ä¸‡ç¾å…ƒäº†"
   "å§æ§½ï¼è‚¡å¸‚æš´è·Œç™¾åˆ†ä¹‹äºŒå"

2. è½¬æŠ˜å¤„ï¼š
   "å¤§å®¶éƒ½ä»¥ä¸ºä¼šæ¶¨ï¼ç»“æœå‘¢ï¼Ÿåè€Œè·Œäº†"

3. æ®µè½å¼€å¤´ï¼ˆå¼•èµ·æ³¨æ„ï¼‰ï¼š
   "æ³¨æ„äº†ï¼æ¥ä¸‹æ¥æ˜¯é‡ç‚¹"

4. æƒ…ç»ªé«˜ç‚¹ï¼š
   "è¿™æ³¢æ“ä½œå¤ªç‰›é€¼äº†ï¼ç›´æ¥ç¿»å€"

// æ’å…¥é¢‘ç‡ï¼š
- æ¯50-80å­—æ’å…¥1ä¸ªè¯­æ°”è¯
- é¿å…è¿ç»­ä½¿ç”¨ç›¸åŒè¯­æ°”è¯
- ä¸è¦è¿‡åº¦ä½¿ç”¨ï¼Œä¿æŒè‡ªç„¶
```

**è§„åˆ™6: å†…å®¹ä¿æŒåŸåˆ™**
```javascript
// å¿…é¡»ä¿æŒçš„å†…å®¹ï¼š
1. æ ¸å¿ƒæ•°æ®å’Œäº‹å®
   - æ•°å­—ï¼ˆè½¬æ¢åçš„å€¼è¦å‡†ç¡®ï¼‰
   - æ—¥æœŸæ—¶é—´
   - äººåã€åœ°åã€æœºæ„å

2. å…³é”®ä¿¡æ¯
   - å› æœå…³ç³»
   - æ—¶é—´é¡ºåº
   - é€»è¾‘ç»“æ„

3. ä¸“ä¸šæœ¯è¯­
   - è¡Œä¸šé»‘è¯ä¿æŒåŸæ ·
   - ä¸è¦è¿‡åº¦è§£é‡Šï¼ˆé™¤éå¿…è¦ï¼‰

// å¯ä»¥åˆ å‡çš„å†…å®¹ï¼š
1. å†—ä½™ä¿®é¥°è¯
2. é‡å¤è¡¨è¿°
3. æ¬¡è¦ç»†èŠ‚
4. è¿‡æ¸¡è¯è¯­
```

**è§„åˆ™7: æ ¼å¼è¦æ±‚**
```javascript
// è¾“å‡ºæ ¼å¼ï¼š
- æ— æ ‡é¢˜
- æ— åˆ†æ®µæ ‡è®°
- ç›´æ¥è¾“å‡ºæ­£æ–‡
- æ¯å¥è¯ç‹¬ç«‹æˆè¡Œï¼ˆå¯é€‰ï¼‰

// è¯­è¨€ç®€æ´åº¦æ§åˆ¶ï¼š
- åŸæ–‡1000å­— â†’ ä¼˜åŒ–å700-800å­—ï¼ˆåˆ å‡20-30%å†—ä½™ï¼‰
- ä¿æŒæ ¸å¿ƒä¿¡æ¯å®Œæ•´
- åˆ é™¤æ— æ„ä¹‰çš„è¿‡æ¸¡å’Œé“ºå«
```

#### 1.3 AIä¼˜åŒ–Promptæ¨¡æ¿

```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°å­—äººå£æ’­ç¨¿ä¼˜åŒ–ä¸“å®¶ï¼Œæ“…é•¿å°†ä»»ä½•æ–‡ç« æ”¹å†™æˆé€‚åˆè¯­éŸ³æœ—è¯»çš„å£æ’­ç¨¿ã€‚

**ä½ çš„ä»»åŠ¡**ï¼šå°†ç”¨æˆ·æä¾›çš„æ–‡ç« æ”¹å†™æˆé£è¶£å¹½é»˜ã€ç®€æ´æœ‰åŠ›çš„å£æ’­ç¨¿ã€‚

**æ”¹å†™è§„åˆ™ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰**ï¼š

1. **è¯­è¨€é£æ ¼**ï¼š
   - å£è¯­åŒ–è¡¨è¾¾ï¼Œé£è¶£å¹½é»˜
   - ç®€æ´æœ‰åŠ›ï¼Œåˆ é™¤å†—ä½™
   - èŠ‚å¥æ„Ÿå¼ºï¼Œé€‚åˆæœ—è¯»

2. **æ ‡ç‚¹ç¬¦å·**ï¼š
   - åªèƒ½ä½¿ç”¨ï¼šå¥å·(ã€‚)ã€æ„Ÿå¹å·(ï¼)ã€é—®å·(ï¼Ÿ)
   - å…¶ä»–æ ‡ç‚¹å…¨éƒ¨åˆ é™¤æˆ–æ›¿æ¢

3. **æ•°å­—è½¬æ¢**ï¼š
   - 8000000 â†’ å…«ç™¾ä¸‡
   - 123 â†’ ä¸€ç™¾äºŒåä¸‰
   - 3.14 â†’ ä¸‰ç‚¹ä¸€å››
   - 50% â†’ ç™¾åˆ†ä¹‹äº”å

4. **è‹±æ–‡ä¿æŒ**ï¼š
   - æ‰€æœ‰è‹±æ–‡å•è¯ã€å“ç‰Œåã€æœ¯è¯­ä¿æŒåŸæ ·
   - ä¸è¦ç¿»è¯‘æˆä¸­æ–‡
   - ç¤ºä¾‹ï¼šChatGPTã€iPhoneã€AIä¿æŒä¸å˜

5. **è¯­æ°”è¯æ·»åŠ ï¼ˆæ ¸å¿ƒè§„åˆ™ï¼‰**ï¼š
   **å¿…é¡»å…ˆåˆ¤æ–­å†…å®¹çš„æƒ…æ„Ÿå±æ€§ï¼Œç„¶åé€‰æ‹©åŒ¹é…çš„è¯­æ°”è¯ï¼š**
   
   - **æ­£é¢æ¶ˆæ¯**ï¼ˆä¸Šæ¶¨ã€æˆåŠŸã€å¥½äº‹ï¼‰â†’ ä½¿ç”¨æ­£é¢è¯­æ°”è¯
     * å¼ºçƒˆï¼šå“‡å¡ã€ç‰›é€¼ã€å¤ªçŒ›äº†
     * ä¸­ç­‰ï¼šå¤ªæ£’äº†ã€ç»™åŠ›ã€èµ
   
   - **è´Ÿé¢æ¶ˆæ¯**ï¼ˆä¸‹è·Œã€å¤±è´¥ã€åäº‹ï¼‰â†’ ä½¿ç”¨è´Ÿé¢è¯­æ°”è¯
     * å¼ºçƒˆï¼šå§æ§½ã€å®Œè›‹äº†ã€æƒ¨äº†ã€å´©äº†
     * ä¸­ç­‰ï¼šç³Ÿç³•ã€è¦å‘½äº†
   
   - **éœ‡æƒŠæ¶ˆæ¯**ï¼ˆæ„å¤–ã€åè½¬ï¼‰â†’ ä½¿ç”¨éœ‡æƒŠè¯­æ°”è¯
     * å¤©å“ªã€å¦ˆè€¶ã€ä¸ä¼šå§ã€ç¦»è°±
   
   - **ç–‘æƒ‘å›°æƒ‘** â†’ å•Šã€å—¯ã€å’¦ã€å¥‡æ€ª
   
   - **å¼ºè°ƒé‡ç‚¹** â†’ æ³¨æ„äº†ã€å¬å¥½äº†ã€é‡ç‚¹æ¥äº†
   
   **ä¸¥ç¦æƒ…æ„Ÿé”™ä½ï¼ç¤ºä¾‹ï¼š**
   - âœ… æ­£ç¡®ï¼š"å§æ§½ï¼è‚¡å¸‚æš´è·Œç™¾åˆ†ä¹‹äºŒå"ï¼ˆè´Ÿé¢ç”¨è´Ÿé¢è¯ï¼‰
   - âŒ é”™è¯¯ï¼š"å“‡å¡ï¼è‚¡å¸‚æš´è·Œç™¾åˆ†ä¹‹äºŒå"ï¼ˆè´Ÿé¢ç”¨æ­£é¢è¯ï¼‰
   - âœ… æ­£ç¡®ï¼š"ç‰›é€¼ï¼æ¯”ç‰¹å¸çªç ´åä¸‡ç¾å…ƒ"ï¼ˆæ­£é¢ç”¨æ­£é¢è¯ï¼‰
   - âŒ é”™è¯¯ï¼š"æƒ¨äº†ï¼æ¯”ç‰¹å¸çªç ´åä¸‡ç¾å…ƒ"ï¼ˆæ­£é¢ç”¨è´Ÿé¢è¯ï¼‰

6. **å†…å®¹ç²¾ç®€**ï¼š
   - åˆ é™¤å†—ä½™è¡¨è¿°
   - ä¿ç•™æ ¸å¿ƒä¿¡æ¯
   - æ•°æ®å¿…é¡»å‡†ç¡®

7. **è¾“å‡ºæ ¼å¼**ï¼š
   - æ— æ ‡é¢˜
   - ç›´æ¥è¾“å‡ºæ­£æ–‡
   - é€‚åˆè¯­éŸ³æœ—è¯»

**å·¥ä½œæµç¨‹**ï¼š
1. ç†è§£åŸæ–‡çš„æ ¸å¿ƒå†…å®¹
2. åˆ¤æ–­æ¯ä¸ªå…³é”®ä¿¡æ¯çš„æƒ…æ„Ÿå±æ€§ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰
3. æ ¹æ®æƒ…æ„Ÿå±æ€§é€‰æ‹©å¯¹åº”çš„è¯­æ°”è¯
4. è¿›è¡Œå£è¯­åŒ–æ”¹å†™
5. å¤„ç†æ ‡ç‚¹å’Œæ•°å­—ï¼Œä¿æŒè‹±æ–‡
6. è‡ªæŸ¥è¯­æ°”è¯æ˜¯å¦ä¸å†…å®¹æƒ…æ„ŸåŒ¹é…

**ç°åœ¨å¼€å§‹æ”¹å†™ä»¥ä¸‹æ–‡æ¡ˆ**ï¼š

{ç”¨æˆ·è¾“å…¥çš„åŸå§‹æ–‡æ¡ˆ}

**ç›´æ¥è¾“å‡ºæ”¹å†™åçš„å£æ’­ç¨¿ï¼Œä¸è¦è§£é‡Šè¿‡ç¨‹**ã€‚
```

#### 1.4 å‰ç«¯å®ç°

```javascript
// Step1ScriptOptimization.jsx
import { useState } from 'react';
import { optimizeService } from '../../services/api';

const Step1ScriptOptimization = ({ data, setData, onNext }) => {
  const [originalText, setOriginalText] = useState('');
  const [optimizedText, setOptimizedText] = useState('');
  const [isOptimizing, setIsOptimizing] = useState(false);
  const [optimizationStats, setOptimizationStats] = useState(null);

  const handleOptimize = async () => {
    if (!originalText || originalText.trim().length < 10) {
      alert('è¯·è¾“å…¥è‡³å°‘10ä¸ªå­—ç¬¦çš„æ–‡æ¡ˆ');
      return;
    }

    setIsOptimizing(true);
    try {
      const response = await optimizeService.optimizeScript(originalText);
      
      setOptimizedText(response.optimizedText);
      setOptimizationStats(response.changes);
      
      // æ›´æ–°çˆ¶ç»„ä»¶æ•°æ®
      setData({
        ...data,
        originalText: originalText,
        optimizedText: response.optimizedText
      });
      
    } catch (error) {
      console.error('ä¼˜åŒ–å¤±è´¥:', error);
      alert('æ–‡æ¡ˆä¼˜åŒ–å¤±è´¥ï¼š' + error.message);
    } finally {
      setIsOptimizing(false);
    }
  };

  const handleManualEdit = (text) => {
    setOptimizedText(text);
    setData({ ...data, optimizedText: text });
  };

  const handleNext = () => {
    if (!optimizedText || optimizedText.trim().length < 10) {
      alert('è¯·å…ˆä¼˜åŒ–æ–‡æ¡ˆæˆ–æ‰‹åŠ¨è¾“å…¥å£æ’­ç¨¿');
      return;
    }
    onNext();
  };

  return (
    <div className="grid grid-cols-2 gap-6">
      {/* å·¦ä¾§ï¼šåŸå§‹æ–‡æ¡ˆè¾“å…¥ */}
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold">ğŸ“ ç²˜è´´æ‚¨çš„åŸå§‹æ–‡æ¡ˆ</h3>
          <span className="text-sm text-gray-500">
            {originalText.length}/10000
          </span>
        </div>
        
        <textarea
          value={originalText}
          onChange={(e) => setOriginalText(e.target.value)}
          placeholder="ç²˜è´´æ‚¨çš„æ–‡ç« æˆ–æ–‡æ¡ˆ..."
          className="w-full h-96 p-4 border rounded-lg resize-none"
          maxLength={10000}
        />
        
        <div className="flex gap-3">
          <button
            onClick={() => setOriginalText('')}
            className="px-4 py-2 border rounded-lg hover:bg-gray-50"
          >
            æ¸…ç©º
          </button>
          <button
            onClick={handleOptimize}
            disabled={isOptimizing || !originalText}
            className="flex-1 px-6 py-2 bg-blue-600 text-white rounded-lg 
                     hover:bg-blue-700 disabled:bg-gray-300"
          >
            {isOptimizing ? 'æ­£åœ¨ä¼˜åŒ–...' : 'âœ¨ AIä¼˜åŒ–æ–‡æ¡ˆ'}
          </button>
        </div>
      </div>

      {/* å³ä¾§ï¼šä¼˜åŒ–åçš„å£æ’­ç¨¿ */}
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold">âœ¨ AIä¼˜åŒ–åçš„å£æ’­ç¨¿</h3>
          {optimizedText && (
            <span className="text-sm text-gray-500">
              {optimizedText.length}/10000
            </span>
          )}
        </div>
        
        {!optimizedText ? (
          <div className="h-96 border-2 border-dashed rounded-lg 
                        flex items-center justify-center text-gray-400">
            <div className="text-center">
              <p className="text-lg mb-2">ğŸ‘ˆ ç²˜è´´æ–‡æ¡ˆåç‚¹å‡»"AIä¼˜åŒ–"</p>
              <p className="text-sm">ç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå£æ’­ç¨¿é£æ ¼</p>
            </div>
          </div>
        ) : (
          <>
            <textarea
              value={optimizedText}
              onChange={(e) => handleManualEdit(e.target.value)}
              className="w-full h-96 p-4 border rounded-lg resize-none"
              maxLength={10000}
            />
            
            {optimizationStats && (
              <div className="p-4 bg-green-50 rounded-lg text-sm space-y-1">
                <p className="font-semibold text-green-800">âœ“ ä¼˜åŒ–å®Œæˆ</p>
                <p>â€¢ æ·»åŠ äº† {optimizationStats.addedExclamations} ä¸ªè¯­æ°”è¯</p>
                <p>â€¢ è½¬æ¢äº† {optimizationStats.convertedNumbers} ä¸ªæ•°å­—</p>
                <p>â€¢ ç®€åŒ–äº† {optimizationStats.simplifiedPunctuation} å¤„æ ‡ç‚¹</p>
                <p>â€¢ å­—æ•°ï¼š{optimizationStats.originalLength} â†’ {optimizationStats.optimizedLength}</p>
                <p className="text-blue-600">
                  â€¢ é¢„è®¡æ—¶é•¿ï¼š{Math.ceil(optimizationStats.optimizedLength / 300)} åˆ†é’Ÿ
                </p>
              </div>
            )}
            
            <div className="flex gap-3">
              <button
                onClick={handleOptimize}
                disabled={isOptimizing}
                className="px-4 py-2 border rounded-lg hover:bg-gray-50"
              >
                ğŸ”„ é‡æ–°ä¼˜åŒ–
              </button>
              <button
                onClick={handleNext}
                className="flex-1 px-6 py-2 bg-blue-600 text-white rounded-lg 
                         hover:bg-blue-700"
              >
                ä¸‹ä¸€æ­¥ï¼šè¯•å¬ç¡®è®¤ â†’
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );
};

export default Step1ScriptOptimization;
```

#### 1.5 åç«¯APIå®ç°

```javascript
// server/routes/optimize.js
import express from 'express';
import { authenticateToken } from '../middleware/auth.js';
import { optimizeScript } from '../services/aiOptimizationService.js';

const router = express.Router();
router.use(authenticateToken);

router.post('/script', async (req, res) => {
  try {
    const { originalText, style = 'humorous' } = req.body;
    
    if (!originalText || originalText.trim().length < 10) {
      return res.status(400).json({
        success: false,
        error: 'invalid_text',
        message: 'æ–‡æ¡ˆé•¿åº¦è‡³å°‘10ä¸ªå­—ç¬¦'
      });
    }
    
    // è°ƒç”¨AIä¼˜åŒ–æœåŠ¡
    const result = await optimizeScript(originalText, style);
    
    res.json({
      success: true,
      optimizedText: result.optimizedText,
      changes: result.stats,
      warnings: result.warnings
    });
    
  } catch (error) {
    console.error('æ–‡æ¡ˆä¼˜åŒ–å¤±è´¥:', error);
    res.status(500).json({
      success: false,
      error: 'optimization_failed',
      message: error.message
    });
  }
});

export default router;
```

```javascript
// server/services/aiOptimizationService.js
import axios from 'axios';

// ä½¿ç”¨OpenAI APIï¼ˆæˆ–å…¶ä»–AIæœåŠ¡ï¼‰
const OPENAI_API_KEY = process.env.OPENAI_API_KEY;
const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

export async function optimizeScript(originalText, style = 'humorous') {
  try {
    // æ„å»ºPrompt
    const prompt = buildOptimizationPrompt(originalText, style);
    
    // è°ƒç”¨OpenAI API
    const response = await axios.post(
      OPENAI_API_URL,
      {
        model: 'gpt-4',
        messages: [
          {
            role: 'system',
            content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°å­—äººå£æ’­ç¨¿ä¼˜åŒ–ä¸“å®¶...'
          },
          {
            role: 'user',
            content: prompt
          }
        ],
        temperature: 0.7,
        max_tokens: 4000
      },
      {
        headers: {
          'Authorization': `Bearer ${OPENAI_API_KEY}`,
          'Content-Type': 'application/json'
        },
        timeout: 60000
      }
    );
    
    const optimizedText = response.data.choices[0].message.content.trim();
    
    // åˆ†æä¼˜åŒ–ç»Ÿè®¡
    const stats = analyzeOptimization(originalText, optimizedText);
    
    // ç”Ÿæˆè­¦å‘Šä¿¡æ¯
    const warnings = generateWarnings(originalText, optimizedText);
    
    return {
      optimizedText,
      stats,
      warnings
    };
    
  } catch (error) {
    console.error('AIä¼˜åŒ–æœåŠ¡è°ƒç”¨å¤±è´¥:', error);
    throw new Error('AIä¼˜åŒ–å¤±è´¥ï¼š' + error.message);
  }
}

function buildOptimizationPrompt(originalText, style) {
  const styleGuide = {
    humorous: 'é£è¶£å¹½é»˜',
    professional: 'ä¸“ä¸šä¸¥è°¨',
    casual: 'è½»æ¾éšæ„'
  };
  
  return `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°å­—äººå£æ’­ç¨¿ä¼˜åŒ–ä¸“å®¶ï¼Œæ“…é•¿å°†ä»»ä½•æ–‡ç« æ”¹å†™æˆé€‚åˆè¯­éŸ³æœ—è¯»çš„å£æ’­ç¨¿ã€‚

[å®Œæ•´çš„Promptæ¨¡æ¿...]

**é£æ ¼è¦æ±‚**: ${styleGuide[style]}

**åŸå§‹æ–‡æ¡ˆ**ï¼š
${originalText}

**è¯·è¾“å‡ºä¼˜åŒ–åçš„å£æ’­ç¨¿**ï¼š
`.trim();
}

function analyzeOptimization(original, optimized) {
  // ç»Ÿè®¡è¯­æ°”è¯
  const exclamations = ['å“‡å¡', 'ç‰›é€¼', 'å§æ§½', 'å¤©å“ª', 'å¦ˆè€¶', 'å¤ªæ£’äº†', 
                       'ç»™åŠ›', 'æƒ¨äº†', 'ç³Ÿç³•', 'ç¦»è°±'];
  const addedExclamations = exclamations.reduce((count, word) => {
    const originalCount = (original.match(new RegExp(word, 'g')) || []).length;
    const optimizedCount = (optimized.match(new RegExp(word, 'g')) || []).length;
    return count + (optimizedCount - originalCount);
  }, 0);
  
  // ç»Ÿè®¡æ•°å­—è½¬æ¢
  const numberRegex = /\d+/g;
  const originalNumbers = (original.match(numberRegex) || []).length;
  const optimizedNumbers = (optimized.match(numberRegex) || []).length;
  const convertedNumbers = originalNumbers - optimizedNumbers;
  
  // ç»Ÿè®¡æ ‡ç‚¹ç®€åŒ–
  const complexPunctuation = /[ï¼Œã€ï¼›ï¼š""''ã€Šã€‹ï¼ˆï¼‰ã€ã€‘]/g;
  const simplifiedPunctuation = (original.match(complexPunctuation) || []).length;
  
  return {
    addedExclamations,
    convertedNumbers,
    simplifiedPunctuation,
    originalLength: original.length,
    optimizedLength: optimized.length
  };
}

function generateWarnings(original, optimized) {
  const warnings = [];
  
  // æ£€æµ‹è´Ÿé¢æ¶ˆæ¯
  const negativeKeywords = ['ä¸‹è·Œ', 'æš´è·Œ', 'å´©ç›˜', 'å¤±è´¥', 'æŸå¤±'];
  const hasNegative = negativeKeywords.some(kw => original.includes(kw));
  if (hasNegative) {
    warnings.push('æ£€æµ‹åˆ°è´Ÿé¢æ¶ˆæ¯ï¼Œå·²ä½¿ç”¨æ°å½“çš„è´Ÿé¢è¯­æ°”è¯');
  }
  
  // æ£€æµ‹æ­£é¢æ¶ˆæ¯
  const positiveKeywords = ['ä¸Šæ¶¨', 'é£™å‡', 'çªç ´', 'æˆåŠŸ', 'åˆ›æ–°'];
  const hasPositive = positiveKeywords.some(kw => original.includes(kw));
  if (hasPositive) {
    warnings.push('æ£€æµ‹åˆ°æ­£é¢æ¶ˆæ¯ï¼Œå·²ä½¿ç”¨æ°å½“çš„æ­£é¢è¯­æ°”è¯');
  }
  
  return warnings;
}
```

---

### Step 2: è¯•å¬ç¡®è®¤ï¼ˆéŸ³é¢‘ç‰‡æ®µé¢„è§ˆï¼‰

#### 2.1 åŠŸèƒ½è¯´æ˜

**ç›®çš„**: è®©ç”¨æˆ·åœ¨æ­£å¼ç”Ÿæˆå‰ï¼Œå…ˆè¯•å¬ä¸€å°æ®µéŸ³é¢‘æ•ˆæœï¼Œç¡®è®¤å£°éŸ³è´¨é‡å’Œå‚æ•°è®¾ç½®ã€‚

**æµç¨‹**:
1. ç³»ç»Ÿè‡ªåŠ¨æå–ä¼˜åŒ–åå£æ’­ç¨¿çš„å‰100å­—ç¬¦ä½œä¸ºè¯•å¬æ–‡æœ¬
2. ç”¨æˆ·é€‰æ‹©å£°éŸ³ç±»å‹ï¼ˆç³»ç»Ÿé¢„åˆ¶ or è‡ªå®šä¹‰å…‹éš†ï¼‰
3. è°ƒèŠ‚å£°éŸ³å‚æ•°ï¼ˆè¯­é€Ÿã€éŸ³è°ƒã€éŸ³é‡ã€æƒ…ç»ªï¼‰
4. ç‚¹å‡»"ç”Ÿæˆè¯•å¬"æŒ‰é’®
5. ç­‰å¾…10-30ç§’ç”ŸæˆéŸ³é¢‘ç‰‡æ®µ
6. æ’­æ”¾è¯•å¬
7. æ»¡æ„åè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œä¸æ»¡æ„å¯é‡æ–°è°ƒæ•´

#### 2.2 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤ è¯•å¬ç¡®è®¤                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  ğŸ“ è¯•å¬æ–‡æœ¬ï¼ˆè‡ªåŠ¨æå–å‰100å­—ï¼‰                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [æ˜¾ç¤ºå‰100å­—çš„æ–‡æœ¬]                                   â”‚   â”‚
â”‚  â”‚ å“‡å¡ï¼æ¯”ç‰¹å¸çªç ´åä¸‡ç¾å…ƒäº†ï¼è¿™å¯æ˜¯å†å²æ€§çš„æ—¶åˆ»...    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  * å®Œæ•´éŸ³é¢‘ç”Ÿæˆæ—¶ä¼šä½¿ç”¨å…¨éƒ¨æ–‡æ¡ˆ                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”Š é€‰æ‹©å£°éŸ³       â”‚  ğŸ›ï¸ è°ƒèŠ‚å‚æ•°                      â”‚   â”‚
â”‚  â”‚                  â”‚                                    â”‚   â”‚
â”‚  â”‚ â—‹ ç³»ç»Ÿé¢„åˆ¶å£°éŸ³    â”‚  è¯­é€Ÿ: [====|====] 1.0x          â”‚   â”‚
â”‚  â”‚   [ä¸‹æ‹‰é€‰æ‹©]     â”‚  éŸ³è°ƒ: [====|====] 1.0x          â”‚   â”‚
â”‚  â”‚   â€¢ ç”·å£°-ç£æ€§     â”‚  éŸ³é‡: [======|==] 0.8           â”‚   â”‚
â”‚  â”‚   â€¢ å¥³å£°-ç”œç¾     â”‚                                    â”‚   â”‚
â”‚  â”‚   â€¢ ç”·å£°-æ²‰ç¨³     â”‚  ğŸ˜Š æƒ…ç»ªæ§åˆ¶                      â”‚   â”‚
â”‚  â”‚   â€¢ å¥³å£°-æ´»åŠ›     â”‚  å¿«ä¹: [=======|=] 0.7           â”‚   â”‚
â”‚  â”‚                  â”‚  æ„¤æ€’: [|========] 0.0           â”‚   â”‚
â”‚  â”‚ â— è‡ªå®šä¹‰å£°éŸ³      â”‚  æ‚²ä¼¤: [|========] 0.1           â”‚   â”‚
â”‚  â”‚   [ä¸Šä¼ æŒ‰é’®]     â”‚  æƒŠè®¶: [==|======] 0.3           â”‚   â”‚
â”‚  â”‚   æˆ–ä»å·²ä¸Šä¼ ä¸­é€‰æ‹© â”‚                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸµ è¯•å¬éŸ³é¢‘                                           â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚ [æœªç”Ÿæˆ]                                              â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚ [ç”Ÿæˆè¯•å¬]  [é‡æ–°ç”Ÿæˆ]                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  æç¤ºï¼šè¯•å¬æ»¡æ„åï¼Œç‚¹å‡»"ä¸‹ä¸€æ­¥"å°†ä½¿ç”¨ç›¸åŒå‚æ•°ç”Ÿæˆå®Œæ•´éŸ³é¢‘    â”‚
â”‚                                                             â”‚
â”‚  [ä¸Šä¸€æ­¥]                            [ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©è§†é¢‘æ¨¡æ¿] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3 å‰ç«¯å®ç°

```javascript
// Step2AudioPreview.jsx
import { useState, useRef, useEffect } from 'react';
import { previewService, uploadService } from '../../services/api';

const Step2AudioPreview = ({ data, setData, onNext, onPrev }) => {
  const [voiceType, setVoiceType] = useState('system'); // 'system' or 'custom'
  const [selectedSystemVoice, setSelectedSystemVoice] = useState('male_magnetic');
  const [customVoiceId, setCustomVoiceId] = useState(null);
  const [userVoices, setUserVoices] = useState([]);
  
  const [voiceSettings, setVoiceSettings] = useState({
    speed: 1.0,
    pitch: 1.0,
    volume: 0.8,
    emotions: {
      happiness: 0.7,
      anger: 0.0,
      sadness: 0.1,
      surprise: 0.3
    }
  });
  
  const [previewAudioUrl, setPreviewAudioUrl] = useState(null);
  const [isGenerating, setIsGenerating] = useState(false);
  const [isPlaying, setIsPlaying] = useState(false);
  
  const audioRef = useRef(null);
  
  // æå–è¯•å¬æ–‡æœ¬ï¼ˆå‰100å­—ï¼‰
  const previewText = data.optimizedText ? 
    data.optimizedText.substring(0, 100) + '...' : 
    '';
  
  // ç³»ç»Ÿé¢„åˆ¶å£°éŸ³åˆ—è¡¨
  const systemVoices = [
    { id: 'male_magnetic', name: 'ç”·å£°-ç£æ€§', description: 'ä½æ²‰æœ‰ç£æ€§' },
    { id: 'female_sweet', name: 'å¥³å£°-ç”œç¾', description: 'æ¸©æŸ”å¯çˆ±' },
    { id: 'male_steady', name: 'ç”·å£°-æ²‰ç¨³', description: 'æˆç†Ÿç¨³é‡' },
    { id: 'female_energetic', name: 'å¥³å£°-æ´»åŠ›', description: 'é’æ˜¥æ´»æ³¼' }
  ];
  
  // åŠ è½½ç”¨æˆ·ä¸Šä¼ çš„å£°éŸ³åˆ—è¡¨
  useEffect(() => {
    loadUserVoices();
  }, []);
  
  const loadUserVoices = async () => {
    try {
      const response = await uploadService.getUserVoices();
      setUserVoices(response.voices || []);
    } catch (error) {
      console.error('åŠ è½½å£°éŸ³åˆ—è¡¨å¤±è´¥:', error);
    }
  };
  
  // ç”Ÿæˆè¯•å¬éŸ³é¢‘
  const handleGeneratePreview = async () => {
    setIsGenerating(true);
    
    try {
      const voiceId = voiceType === 'system' ? 
        selectedSystemVoice : 
        customVoiceId;
      
      if (!voiceId) {
        alert('è¯·é€‰æ‹©å£°éŸ³');
        return;
      }
      
      // è°ƒç”¨è¯•å¬API
      const audioBlob = await previewService.generateTTS(
        previewText,
        voiceId,
        voiceSettings
      );
      
      // åˆ›å»ºéŸ³é¢‘URL
      if (previewAudioUrl) {
        URL.revokeObjectURL(previewAudioUrl);
      }
      const newUrl = URL.createObjectURL(audioBlob);
      setPreviewAudioUrl(newUrl);
      
      // è‡ªåŠ¨æ’­æ”¾
      setTimeout(() => {
        playAudio();
      }, 100);
      
    } catch (error) {
      console.error('ç”Ÿæˆè¯•å¬å¤±è´¥:', error);
      alert('è¯•å¬ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
    } finally {
      setIsGenerating(false);
    }
  };
  
  const playAudio = () => {
    if (!audioRef.current || !previewAudioUrl) return;
    
    audioRef.current.src = previewAudioUrl;
    audioRef.current.play();
    setIsPlaying(true);
  };
  
  const stopAudio = () => {
    if (!audioRef.current) return;
    audioRef.current.pause();
    audioRef.current.currentTime = 0;
    setIsPlaying(false);
  };
  
  const handleNext = () => {
    if (!previewAudioUrl) {
      alert('è¯·å…ˆç”Ÿæˆè¯•å¬éŸ³é¢‘ç¡®è®¤æ•ˆæœ');
      return;
    }
    
    // ä¿å­˜å£°éŸ³è®¾ç½®
    setData({
      ...data,
      voiceType,
      voiceId: voiceType === 'system' ? selectedSystemVoice : customVoiceId,
      voiceSettings
    });
    
    onNext();
  };
  
  // å£°éŸ³ä¸Šä¼ 
  const handleUploadVoice = async (file) => {
    try {
      const formData = new FormData();
      formData.append('voice', file);
      
      const response = await uploadService.uploadVoice(formData);
      
      // æ·»åŠ åˆ°åˆ—è¡¨
      setUserVoices([response.voice, ...userVoices]);
      setCustomVoiceId(response.voice.voiceId);
      setVoiceType('custom');
      
      alert('å£°éŸ³ä¸Šä¼ æˆåŠŸï¼');
      
    } catch (error) {
      console.error('ä¸Šä¼ å¤±è´¥:', error);
      alert('ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
    }
  };
  
  return (
    <div className="max-w-4xl mx-auto space-y-6">
      {/* è¯•å¬æ–‡æœ¬ */}
      <div>
        <h3 className="text-lg font-semibold mb-2">ğŸ“ è¯•å¬æ–‡æœ¬</h3>
        <div className="p-4 bg-gray-50 rounded-lg">
          <p className="text-gray-800">{previewText}</p>
          <p className="text-xs text-gray-500 mt-2">
            * å®Œæ•´éŸ³é¢‘ç”Ÿæˆæ—¶ä¼šä½¿ç”¨å…¨éƒ¨æ–‡æ¡ˆ
          </p>
        </div>
      </div>
      
      <div className="grid grid-cols-2 gap-6">
        {/* å·¦ä¾§ï¼šé€‰æ‹©å£°éŸ³ */}
        <div className="space-y-4">
          <h3 className="text-lg font-semibold">ğŸ”Š é€‰æ‹©å£°éŸ³</h3>
          
          {/* ç³»ç»Ÿé¢„åˆ¶å£°éŸ³ */}
          <div>
            <label className="flex items-center gap-2 mb-3">
              <input
                type="radio"
                checked={voiceType === 'system'}
                onChange={() => setVoiceType('system')}
              />
              <span className="font-medium">ç³»ç»Ÿé¢„åˆ¶å£°éŸ³</span>
            </label>
            
            {voiceType === 'system' && (
              <select
                value={selectedSystemVoice}
                onChange={(e) => setSelectedSystemVoice(e.target.value)}
                className="w-full p-2 border rounded-lg"
              >
                {systemVoices.map(voice => (
                  <option key={voice.id} value={voice.id}>
                    {voice.name} - {voice.description}
                  </option>
                ))}
              </select>
            )}
          </div>
          
          {/* è‡ªå®šä¹‰å£°éŸ³ */}
          <div>
            <label className="flex items-center gap-2 mb-3">
              <input
                type="radio"
                checked={voiceType === 'custom'}
                onChange={() => setVoiceType('custom')}
              />
              <span className="font-medium">è‡ªå®šä¹‰å£°éŸ³</span>
            </label>
            
            {voiceType === 'custom' && (
              <>
                <input
                  type="file"
                  accept=".wav,.mp3,.m4a"
                  onChange={(e) => handleUploadVoice(e.target.files[0])}
                  className="w-full p-2 border rounded-lg mb-3"
                />
                
                {userVoices.length > 0 && (
                  <div className="space-y-2">
                    <p className="text-sm text-gray-600">æˆ–ä»å·²ä¸Šä¼ ä¸­é€‰æ‹©ï¼š</p>
                    {userVoices.map(voice => (
                      <label
                        key={voice.voiceId}
                        className="flex items-center gap-2 p-2 border rounded hover:bg-gray-50"
                      >
                        <input
                          type="radio"
                          name="customVoice"
                          checked={customVoiceId === voice.voiceId}
                          onChange={() => setCustomVoiceId(voice.voiceId)}
                        />
                        <span>{voice.fileName}</span>
                      </label>
                    ))}
                  </div>
                )}
              </>
            )}
          </div>
        </div>
        
        {/* å³ä¾§ï¼šè°ƒèŠ‚å‚æ•° */}
        <div className="space-y-4">
          <h3 className="text-lg font-semibold">ğŸ›ï¸ è°ƒèŠ‚å‚æ•°</h3>
          
          {/* è¯­é€Ÿ */}
          <div>
            <label className="block text-sm mb-1">
              è¯­é€Ÿ: {voiceSettings.speed}x
            </label>
            <input
              type="range"
              min="0.5"
              max="2.0"
              step="0.1"
              value={voiceSettings.speed}
              onChange={(e) => setVoiceSettings({
                ...voiceSettings,
                speed: parseFloat(e.target.value)
              })}
              className="w-full"
            />
          </div>
          
          {/* éŸ³è°ƒ */}
          <div>
            <label className="block text-sm mb-1">
              éŸ³è°ƒ: {voiceSettings.pitch}x
            </label>
            <input
              type="range"
              min="0.5"
              max="2.0"
              step="0.1"
              value={voiceSettings.pitch}
              onChange={(e) => setVoiceSettings({
                ...voiceSettings,
                pitch: parseFloat(e.target.value)
              })}
              className="w-full"
            />
          </div>
          
          {/* éŸ³é‡ */}
          <div>
            <label className="block text-sm mb-1">
              éŸ³é‡: {(voiceSettings.volume * 100).toFixed(0)}%
            </label>
            <input
              type="range"
              min="0.0"
              max="1.0"
              step="0.1"
              value={voiceSettings.volume}
              onChange={(e) => setVoiceSettings({
                ...voiceSettings,
                volume: parseFloat(e.target.value)
              })}
              className="w-full"
            />
          </div>
          
          {/* æƒ…ç»ªæ§åˆ¶ */}
          <div className="pt-4 border-t">
            <h4 className="text-sm font-semibold mb-3">ğŸ˜Š æƒ…ç»ªæ§åˆ¶</h4>
            
            {Object.entries({
              happiness: 'å¿«ä¹',
              anger: 'æ„¤æ€’',
              sadness: 'æ‚²ä¼¤',
              surprise: 'æƒŠè®¶'
            }).map(([key, label]) => (
              <div key={key} className="mb-2">
                <label className="block text-xs mb-1">
                  {label}: {voiceSettings.emotions[key].toFixed(1)}
                </label>
                <input
                  type="range"
                  min="0.0"
                  max="1.0"
                  step="0.1"
                  value={voiceSettings.emotions[key]}
                  onChange={(e) => setVoiceSettings({
                    ...voiceSettings,
                    emotions: {
                      ...voiceSettings.emotions,
                      [key]: parseFloat(e.target.value)
                    }
                  })}
                  className="w-full"
                />
              </div>
            ))}
          </div>
        </div>
      </div>
      
      {/* è¯•å¬éŸ³é¢‘åŒºåŸŸ */}
      <div className="p-6 border-2 border-dashed rounded-lg">
        <h3 className="text-lg font-semibold mb-4">ğŸµ è¯•å¬éŸ³é¢‘</h3>
        
        {!previewAudioUrl ? (
          <div className="text-center py-8">
            <p className="text-gray-500 mb-4">è¿˜æœªç”Ÿæˆè¯•å¬éŸ³é¢‘</p>
            <button
              onClick={handleGeneratePreview}
              disabled={isGenerating}
              className="px-6 py-3 bg-blue-600 text-white rounded-lg 
                       hover:bg-blue-700 disabled:bg-gray-300"
            >
              {isGenerating ? 'ç”Ÿæˆä¸­...' : 'ğŸ¤ ç”Ÿæˆè¯•å¬'}
            </button>
          </div>
        ) : (
          <div className="space-y-4">
            <audio
              ref={audioRef}
              onEnded={() => setIsPlaying(false)}
              className="w-full"
              controls
            />
            
            <div className="flex gap-3">
              <button
                onClick={handleGeneratePreview}
                disabled={isGenerating}
                className="px-4 py-2 border rounded-lg hover:bg-gray-50"
              >
                ğŸ”„ é‡æ–°ç”Ÿæˆ
              </button>
              <button
                onClick={isPlaying ? stopAudio : playAudio}
                className="px-4 py-2 bg-green-600 text-white rounded-lg 
                         hover:bg-green-700"
              >
                {isPlaying ? 'â¸ï¸ æš‚åœ' : 'â–¶ï¸ æ’­æ”¾'}
              </button>
            </div>
          </div>
        )}
      </div>
      
      <div className="text-sm text-gray-600 bg-blue-50 p-4 rounded-lg">
        ğŸ’¡ æç¤ºï¼šè¯•å¬æ»¡æ„åï¼Œç‚¹å‡»"ä¸‹ä¸€æ­¥"å°†ä½¿ç”¨ç›¸åŒå‚æ•°ç”Ÿæˆå®Œæ•´éŸ³é¢‘
      </div>
      
      {/* å¯¼èˆªæŒ‰é’® */}
      <div className="flex justify-between pt-6">
        <button
          onClick={onPrev}
          className="px-6 py-2 border rounded-lg hover:bg-gray-50"
        >
          â† ä¸Šä¸€æ­¥
        </button>
        <button
          onClick={handleNext}
          disabled={!previewAudioUrl}
          className="px-6 py-2 bg-blue-600 text-white rounded-lg 
                   hover:bg-blue-700 disabled:bg-gray-300"
        >
          ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©è§†é¢‘æ¨¡æ¿ â†’
        </button>
      </div>
    </div>
  );
};

export default Step2AudioPreview;
```

---

### Step 3: é€‰æ‹©è§†é¢‘æ¨¡æ¿

ï¼ˆä¿æŒåŸè®¾è®¡ï¼Œå‚è€ƒåŸæ–‡æ¡£ Step 3ï¼‰

---

### Step 4: é•¿è§†é¢‘æ™ºèƒ½åˆ†æ®µ

#### 4.1 åŠŸèƒ½è¯´æ˜

**é—®é¢˜**: 
- Wan2.1æ¨¡å‹å•æ¬¡ç”Ÿæˆè§†é¢‘æœ‰æ—¶é•¿é™åˆ¶ï¼ˆé€šå¸¸30-60ç§’ï¼‰
- ç”¨æˆ·çš„æ–‡æ¡ˆå¯èƒ½å¾ˆé•¿ï¼ˆ5-10åˆ†é’Ÿï¼‰
- ä¸€æ¬¡æ€§ç”Ÿæˆé•¿è§†é¢‘é€Ÿåº¦æ…¢ã€å®¹æ˜“å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æ–‡æœ¬é•¿åº¦
- å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚180ç§’ï¼‰ï¼Œæç¤ºç”¨æˆ·åˆ†æ®µç”Ÿæˆ
- ç”¨æˆ·å¯é€‰æ‹©ï¼š
  - æ–¹æ¡ˆAï¼šåˆ†æ®µç”Ÿæˆï¼Œç„¶åè‡ªåŠ¨åˆæˆï¼ˆæ¨èï¼‰
  - æ–¹æ¡ˆBï¼šåªç”Ÿæˆå‰Nåˆ†é’Ÿ
  - æ–¹æ¡ˆCï¼šæ‰‹åŠ¨é€‰æ‹©è¦ç”Ÿæˆçš„æ®µè½

#### 4.2 åˆ†æ®µç­–ç•¥

```javascript
// server/services/videoSegmentationService.js

/**
 * æ™ºèƒ½åˆ†æ®µç­–ç•¥
 * 
 * ç›®æ ‡ï¼šå°†é•¿æ–‡æœ¬åˆ†å‰²æˆå¤šä¸ªé€‚åˆè§†é¢‘ç”Ÿæˆçš„æ®µè½
 * 
 * è§„åˆ™ï¼š
 * 1. æ¯æ®µæ—¶é•¿æ§åˆ¶åœ¨30-60ç§’ï¼ˆ90-180å­—ç¬¦ï¼‰
 * 2. åœ¨å¥å­è¾¹ç•Œåˆ†å‰²ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´
 * 3. æ®µè½é—´è¦æœ‰é€»è¾‘è¿è´¯æ€§
 * 4. æ¯æ®µç‹¬ç«‹ç”Ÿæˆè§†é¢‘ï¼Œæœ€ååˆæˆ
 */

class VideoSegmentationService {
  constructor() {
    this.TARGET_SEGMENT_LENGTH = 150; // ç›®æ ‡æ¯æ®µ150å­—ç¬¦ï¼ˆçº¦30ç§’ï¼‰
    this.MAX_SEGMENT_LENGTH = 180;    // æœ€å¤§æ¯æ®µ180å­—ç¬¦ï¼ˆçº¦36ç§’ï¼‰
    this.MIN_SEGMENT_LENGTH = 90;     // æœ€å°æ¯æ®µ90å­—ç¬¦ï¼ˆçº¦18ç§’ï¼‰
  }
  
  /**
   * åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†æ®µ
   */
  needsSegmentation(text) {
    const estimatedDuration = this.estimateDuration(text);
    return estimatedDuration > 60; // è¶…è¿‡60ç§’éœ€è¦åˆ†æ®µ
  }
  
  /**
   * ä¼°ç®—æ—¶é•¿ï¼ˆç§’ï¼‰
   */
  estimateDuration(text) {
    const charCount = text.length;
    return Math.ceil(charCount / 5); // å‡è®¾5å­—ç¬¦/ç§’
  }
  
  /**
   * æ™ºèƒ½åˆ†æ®µ
   */
  segmentText(text) {
    const sentences = this.splitIntoSentences(text);
    const segments = [];
    let currentSegment = '';
    
    for (const sentence of sentences) {
      const potentialLength = currentSegment.length + sentence.length;
      
      if (currentSegment === '') {
        // ç¬¬ä¸€ä¸ªå¥å­ç›´æ¥åŠ å…¥
        currentSegment = sentence;
      } else if (potentialLength <= this.MAX_SEGMENT_LENGTH) {
        // æ²¡è¶…è¿‡æœ€å¤§é•¿åº¦ï¼Œç»§ç»­ç´¯åŠ 
        currentSegment += sentence;
      } else if (currentSegment.length >= this.MIN_SEGMENT_LENGTH) {
        // å½“å‰æ®µå·²ç»è¾¾åˆ°æœ€å°é•¿åº¦ï¼Œä¿å­˜å¹¶å¼€å§‹æ–°æ®µ
        segments.push(currentSegment);
        currentSegment = sentence;
      } else {
        // å½“å‰æ®µè¿˜ä¸å¤Ÿé•¿ï¼Œä½†åŠ ä¸Šè¿™å¥ä¼šè¶…ï¼Œå¼ºåˆ¶åŠ å…¥
        currentSegment += sentence;
        segments.push(currentSegment);
        currentSegment = '';
      }
    }
    
    // å¤„ç†æœ€åä¸€æ®µ
    if (currentSegment.length > 0) {
      if (currentSegment.length < this.MIN_SEGMENT_LENGTH && segments.length > 0) {
        // æœ€åä¸€æ®µå¤ªçŸ­ï¼Œåˆå¹¶åˆ°å‰ä¸€æ®µ
        segments[segments.length - 1] += currentSegment;
      } else {
        segments.push(currentSegment);
      }
    }
    
    return segments.map((text, index) => ({
      index: index + 1,
      text: text,
      charCount: text.length,
      estimatedDuration: this.estimateDuration(text)
    }));
  }
  
  /**
   * æŒ‰å¥å­åˆ†å‰²
   */
  splitIntoSentences(text) {
    // æŒ‰å¥å·ã€æ„Ÿå¹å·ã€é—®å·åˆ†å‰²
    const regex = /[ã€‚ï¼ï¼Ÿ]+/g;
    const sentences = [];
    let lastIndex = 0;
    let match;
    
    while ((match = regex.exec(text)) !== null) {
      const sentence = text.substring(lastIndex, match.index + match[0].length);
      sentences.push(sentence);
      lastIndex = match.index + match[0].length;
    }
    
    // å¤„ç†æœ€åä¸€éƒ¨åˆ†ï¼ˆå¦‚æœæ²¡æœ‰æ ‡ç‚¹ç»“å°¾ï¼‰
    if (lastIndex < text.length) {
      sentences.push(text.substring(lastIndex));
    }
    
    return sentences;
  }
  
  /**
   * ç”Ÿæˆåˆ†æ®µå»ºè®®
   */
  generateSegmentationPlan(text) {
    const segments = this.segmentText(text);
    const totalDuration = segments.reduce((sum, seg) => sum + seg.estimatedDuration, 0);
    
    return {
      needsSegmentation: this.needsSegmentation(text),
      totalCharacters: text.length,
      totalDuration: totalDuration,
      segmentCount: segments.length,
      segments: segments,
      recommendation: this.generateRecommendation(segments)
    };
  }
  
  generateRecommendation(segments) {
    if (segments.length <= 2) {
      return 'å»ºè®®ç›´æ¥ç”Ÿæˆå®Œæ•´è§†é¢‘';
    } else if (segments.length <= 5) {
      return 'å»ºè®®åˆ†æ®µç”Ÿæˆå¹¶è‡ªåŠ¨åˆæˆï¼ˆæ¨èï¼‰';
    } else {
      return 'å»ºè®®è€ƒè™‘ç¼©å‡æ–‡æ¡ˆé•¿åº¦ï¼Œæˆ–åˆ†å¤šæ¬¡ç”Ÿæˆ';
    }
  }
}

module.exports = new VideoSegmentationService();
```

#### 4.3 å‰ç«¯å®ç°

```javascript
// Step4SegmentationConfirm.jsx
import { useState, useEffect } from 'react';
import { segmentationService } from '../../services/api';

const Step4SegmentationConfirm = ({ data, setData, onNext, onPrev }) => {
  const [segmentationPlan, setSegmentationPlan] = useState(null);
  const [selectedStrategy, setSelectedStrategy] = useState('auto_merge'); // 'auto_merge', 'partial', 'manual'
  const [selectedSegments, setSelectedSegments] = useState([]);
  
  useEffect(() => {
    analyzeSeg mentation();
  }, []);
  
  const analyzeSegmentation = async () => {
    try {
      const response = await segmentationService.analyze(data.optimizedText);
      setSegmentationPlan(response);
      
      // é»˜è®¤é€‰ä¸­æ‰€æœ‰æ®µè½
      if (response.segments) {
        setSelectedSegments(response.segments.map(s => s.index));
      }
      
    } catch (error) {
      console.error('åˆ†æ®µåˆ†æå¤±è´¥:', error);
    }
  };
  
  const handleNext = () => {
    setData({
      ...data,
      segmentationStrategy: selectedStrategy,
      selectedSegments: selectedStrategy === 'manual' ? selectedSegments : null,
      segmentationPlan
    });
    onNext();
  };
  
  if (!segmentationPlan) {
    return <div>æ­£åœ¨åˆ†ææ–‡æœ¬é•¿åº¦...</div>;
  }
  
  // å¦‚æœä¸éœ€è¦åˆ†æ®µï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥
  if (!segmentationPlan.needsSegmentation) {
    useEffect(() => {
      setData({ ...data, segmentationStrategy: 'none' });
      onNext();
    }, []);
    return <div>æ–‡æœ¬é•¿åº¦é€‚ä¸­ï¼Œæ— éœ€åˆ†æ®µ...</div>;
  }
  
  return (
    <div className="max-w-4xl mx-auto space-y-6">
      <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4">
        <h3 className="font-semibold text-yellow-800 mb-2">
          âš ï¸ æ£€æµ‹åˆ°é•¿æ–‡æœ¬
        </h3>
        <p className="text-yellow-700">
          æ‚¨çš„æ–‡æ¡ˆè¾ƒé•¿ï¼ˆçº¦{segmentationPlan.totalDuration}ç§’ï¼‰ï¼Œ
          ä¸ºäº†ä¿è¯ç”Ÿæˆè´¨é‡å’Œé€Ÿåº¦ï¼Œå»ºè®®é‡‡ç”¨åˆ†æ®µç”Ÿæˆæ–¹æ¡ˆã€‚
        </p>
      </div>
      
      {/* åˆ†æ®µæ¦‚è§ˆ */}
      <div className="p-6 bg-gray-50 rounded-lg">
        <h3 className="text-lg font-semibold mb-4">ğŸ“Š åˆ†æ®µæ¦‚è§ˆ</h3>
        <div className="grid grid-cols-4 gap-4 text-center">
          <div>
            <p className="text-2xl font-bold text-blue-600">
              {segmentationPlan.totalCharacters}
            </p>
            <p className="text-sm text-gray-600">æ€»å­—ç¬¦æ•°</p>
          </div>
          <div>
            <p className="text-2xl font-bold text-green-600">
              {segmentationPlan.totalDuration}ç§’
            </p>
            <p className="text-sm text-gray-600">é¢„è®¡æ€»æ—¶é•¿</p>
          </div>
          <div>
            <p className="text-2xl font-bold text-purple-600">
              {segmentationPlan.segmentCount}
            </p>
            <p className="text-sm text-gray-600">å»ºè®®åˆ†æ®µæ•°</p>
          </div>
          <div>
            <p className="text-2xl font-bold text-orange-600">
              {Math.ceil(segmentationPlan.totalDuration / 30 * 30)}
            </p>
            <p className="text-sm text-gray-600">é¢„è®¡æ¶ˆè€—ç§¯åˆ†</p>
          </div>
        </div>
        <p className="mt-4 text-sm text-gray-600 text-center">
          ğŸ’¡ {segmentationPlan.recommendation}
        </p>
      </div>
      
      {/* ç”Ÿæˆç­–ç•¥é€‰æ‹© */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold">ğŸ¯ é€‰æ‹©ç”Ÿæˆç­–ç•¥</h3>
        
        {/* ç­–ç•¥1ï¼šè‡ªåŠ¨åˆ†æ®µåˆæˆ */}
        <label className="block p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500
                        ${selectedStrategy === 'auto_merge' ? 'border-blue-500 bg-blue-50' : ''}">
          <div className="flex items-start gap-3">
            <input
              type="radio"
              value="auto_merge"
              checked={selectedStrategy === 'auto_merge'}
              onChange={(e) => setSelectedStrategy(e.target.value)}
              className="mt-1"
            />
            <div className="flex-1">
              <p className="font-semibold text-lg">
                âœ¨ è‡ªåŠ¨åˆ†æ®µå¹¶åˆæˆï¼ˆæ¨èï¼‰
              </p>
              <p className="text-sm text-gray-600 mt-1">
                ç³»ç»Ÿè‡ªåŠ¨å°†æ–‡æ¡ˆåˆ†æˆ{segmentationPlan.segmentCount}æ®µï¼Œ
                æ¯æ®µç‹¬ç«‹ç”Ÿæˆè§†é¢‘ï¼Œæœ€åè‡ªåŠ¨åˆæˆä¸ºä¸€ä¸ªå®Œæ•´è§†é¢‘ã€‚
              </p>
              <div className="mt-2 text-sm">
                <span className="text-green-600">âœ“ è´¨é‡æœ€ä½³</span>
                <span className="mx-2">â€¢</span>
                <span className="text-green-600">âœ“ å…¨è‡ªåŠ¨å¤„ç†</span>
                <span className="mx-2">â€¢</span>
                <span className="text-green-600">âœ“ æ— ç¼è¡”æ¥</span>
              </div>
            </div>
          </div>
        </label>
        
        {/* ç­–ç•¥2ï¼šåªç”Ÿæˆéƒ¨åˆ† */}
        <label className="block p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500
                        ${selectedStrategy === 'partial' ? 'border-blue-500 bg-blue-50' : ''}">
          <div className="flex items-start gap-3">
            <input
              type="radio"
              value="partial"
              checked={selectedStrategy === 'partial'}
              onChange={(e) => setSelectedStrategy(e.target.value)}
              className="mt-1"
            />
            <div className="flex-1">
              <p className="font-semibold text-lg">
                âš¡ åªç”Ÿæˆå‰60ç§’
              </p>
              <p className="text-sm text-gray-600 mt-1">
                åªç”Ÿæˆå‰{Math.min(60, segmentationPlan.totalDuration)}ç§’å†…å®¹ï¼Œ
                é€‚åˆå¿«é€Ÿé¢„è§ˆæ•ˆæœã€‚
              </p>
              <div className="mt-2 text-sm">
                <span className="text-blue-600">âœ“ é€Ÿåº¦æœ€å¿«</span>
                <span className="mx-2">â€¢</span>
                <span className="text-blue-600">âœ“ èŠ‚çœç§¯åˆ†</span>
                <span className="mx-2">â€¢</span>
                <span className="text-orange-600">âš ï¸ å†…å®¹ä¸å®Œæ•´</span>
              </div>
            </div>
          </div>
        </label>
        
        {/* ç­–ç•¥3ï¼šæ‰‹åŠ¨é€‰æ‹©æ®µè½ */}
        <label className="block p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500
                        ${selectedStrategy === 'manual' ? 'border-blue-500 bg-blue-50' : ''}">
          <div className="flex items-start gap-3">
            <input
              type="radio"
              value="manual"
              checked={selectedStrategy === 'manual'}
              onChange={(e) => setSelectedStrategy(e.target.value)}
              className="mt-1"
            />
            <div className="flex-1">
              <p className="font-semibold text-lg">
                ğŸ¨ æ‰‹åŠ¨é€‰æ‹©æ®µè½
              </p>
              <p className="text-sm text-gray-600 mt-1">
                è‡ªå·±é€‰æ‹©è¦ç”Ÿæˆå“ªäº›æ®µè½ï¼Œå¯ä»¥åˆ†æ‰¹ç”Ÿæˆã€‚
              </p>
              <div className="mt-2 text-sm">
                <span className="text-purple-600">âœ“ çµæ´»å¯æ§</span>
                <span className="mx-2">â€¢</span>
                <span className="text-purple-600">âœ“ æŒ‰éœ€ç”Ÿæˆ</span>
              </div>
            </div>
          </div>
        </label>
      </div>
      
      {/* å¦‚æœé€‰æ‹©æ‰‹åŠ¨ï¼Œæ˜¾ç¤ºæ®µè½åˆ—è¡¨ */}
      {selectedStrategy === 'manual' && (
        <div className="space-y-3">
          <h4 className="font-semibold">é€‰æ‹©è¦ç”Ÿæˆçš„æ®µè½ï¼š</h4>
          {segmentationPlan.segments.map(segment => (
            <label
              key={segment.index}
              className="block p-4 border rounded-lg cursor-pointer hover:bg-gray-50"
            >
              <div className="flex items-start gap-3">
                <input
                  type="checkbox"
                  checked={selectedSegments.includes(segment.index)}
                  onChange={(e) => {
                    if (e.target.checked) {
                      setSelectedSegments([...selectedSegments, segment.index]);
                    } else {
                      setSelectedSegments(selectedSegments.filter(i => i !== segment.index));
                    }
                  }}
                  className="mt-1"
                />
                <div className="flex-1">
                  <div className="flex justify-between items-start mb-2">
                    <span className="font-semibold">
                      æ®µè½ {segment.index}
                    </span>
                    <span className="text-sm text-gray-500">
                      {segment.charCount}å­— â€¢ çº¦{segment.estimatedDuration}ç§’
                    </span>
                  </div>
                  <p className="text-sm text-gray-600">
                    {segment.text.substring(0, 80)}...
                  </p>
                </div>
              </div>
            </label>
          ))}
        </div>
      )}
      
      {/* å¯¼èˆªæŒ‰é’® */}
      <div className="flex justify-between pt-6">
        <button
          onClick={onPrev}
          className="px-6 py-2 border rounded-lg hover:bg-gray-50"
        >
          â† ä¸Šä¸€æ­¥
        </button>
        <button
          onClick={handleNext}
          className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          ä¸‹ä¸€æ­¥ï¼šç¡®è®¤ç”Ÿæˆ â†’
        </button>
      </div>
    </div>
  );
};

export default Step4SegmentationConfirm;
```

#### 4.4 åç«¯åˆ†æ®µç”Ÿæˆ

```javascript
// server/controllers/generateController.js (ä¼˜åŒ–ç‰ˆ)

async function createVideoGeneration(req, res) {
  const userId = req.user.id;
  const { 
    text, 
    voiceSettings, 
    templateId,
    segmentationStrategy,
    selectedSegments,
    segmentationPlan
  } = req.body;
  
  try {
    // 1. éªŒè¯ç§¯åˆ†
    const user = await dbGet('SELECT credits FROM users WHERE id = ?', [userId]);
    const requiredCredits = calculateCredits(text);
    
    if (user.credits < requiredCredits) {
      return res.status(400).json({
        success: false,
        error: 'insufficient_credits'
      });
    }
    
    // 2. åˆ›å»ºä¸»ä»»åŠ¡
    const generationId = `gen_${Date.now()}`;
    await dbRun(`
      INSERT INTO generations 
      (id, user_id, text_content, voice_settings, template_id, 
       status, credits_cost, segmentation_strategy)
      VALUES (?, ?, ?, ?, ?, 'pending', ?, ?)
    `, [
      generationId, userId, text,
      JSON.stringify(voiceSettings), templateId,
      requiredCredits, segmentationStrategy
    ]);
    
    // 3. é¢„æ‰£ç§¯åˆ†
    await deductCredits(userId, requiredCredits, generationId);
    
    // 4. åˆ¤æ–­ç”Ÿæˆç­–ç•¥
    if (segmentationStrategy === 'none') {
      // ç›´æ¥ç”Ÿæˆ
      processGeneration(generationId, text, voiceSettings, templateId, userId);
      
    } else if (segmentationStrategy === 'auto_merge') {
      // åˆ†æ®µç”Ÿæˆå¹¶åˆæˆ
      processSegmentedGeneration(
        generationId, 
        segmentationPlan.segments, 
        voiceSettings, 
        templateId, 
        userId
      );
      
    } else if (segmentationStrategy === 'partial') {
      // åªç”Ÿæˆå‰60ç§’
      const partialText = text.substring(0, 300); // çº¦60ç§’
      processGeneration(generationId, partialText, voiceSettings, templateId, userId);
      
    } else if (segmentationStrategy === 'manual') {
      // åªç”Ÿæˆé€‰ä¸­çš„æ®µè½
      const selectedSegmentTexts = segmentationPlan.segments
        .filter(s => selectedSegments.includes(s.index))
        .map(s => s.text);
      
      processSegmentedGeneration(
        generationId,
        selectedSegmentTexts,
        voiceSettings,
        templateId,
        userId
      );
    }
    
    // 5. è¿”å›ä»»åŠ¡ID
    res.json({
      success: true,
      generationId,
      segmentationStrategy,
      segmentCount: segmentationPlan?.segments?.length || 1
    });
    
  } catch (error) {
    console.error('åˆ›å»ºç”Ÿæˆä»»åŠ¡å¤±è´¥:', error);
    res.status(500).json({ success: false, error: error.message });
  }
}

/**
 * åˆ†æ®µç”Ÿæˆå¹¶åˆæˆ
 */
async function processSegmentedGeneration(generationId, segments, voiceSettings, templateId, userId) {
  try {
    await dbRun(
      'UPDATE generations SET status = ? WHERE id = ?',
      ['processing', generationId]
    );
    
    const segmentVideos = [];
    
    // é€æ®µç”Ÿæˆ
    for (let i = 0; i < segments.length; i++) {
      const segment = segments[i];
      console.log(`ç”Ÿæˆæ®µè½ ${i + 1}/${segments.length}...`);
      
      // æ›´æ–°è¿›åº¦
      await dbRun(
        'UPDATE generations SET progress = ? WHERE id = ?',
        [Math.round((i / segments.length) * 80), generationId]
      );
      
      // 1. ç”ŸæˆTTS
      const audioPath = await generateTTS(segment.text, voiceSettings);
      
      // 2. ç”Ÿæˆè§†é¢‘
      const videoPath = await generateVideo(audioPath, templateId);
      
      segmentVideos.push(videoPath);
    }
    
    // æ›´æ–°è¿›åº¦ï¼šå¼€å§‹åˆæˆ
    await dbRun(
      'UPDATE generations SET progress = ? WHERE id = ?',
      [85, generationId]
    );
    
    // åˆæˆæ‰€æœ‰æ®µè½è§†é¢‘
    const finalVideoPath = await mergeVideos(segmentVideos, generationId);
    
    // æ›´æ–°å®ŒæˆçŠ¶æ€
    await dbRun(`
      UPDATE generations 
      SET status = 'completed', 
          video_url = ?, 
          progress = 100,
          completed_at = CURRENT_TIMESTAMP 
      WHERE id = ?
    `, [finalVideoPath, generationId]);
    
    console.log(`âœ… åˆ†æ®µç”Ÿæˆå®Œæˆ: ${generationId}`);
    
  } catch (error) {
    console.error('åˆ†æ®µç”Ÿæˆå¤±è´¥:', error);
    await handleGenerationFailure(generationId, userId, error.message);
  }
}

/**
 * åˆæˆå¤šä¸ªè§†é¢‘ç‰‡æ®µ
 */
async function mergeVideos(videoPaths, generationId) {
  const ffmpeg = require('fluent-ffmpeg');
  const outputPath = path.join(
    __dirname, '../../public/uploads/videos',
    `${generationId}_merged.mp4`
  );
  
  return new Promise((resolve, reject) => {
    const command = ffmpeg();
    
    // æ·»åŠ æ‰€æœ‰è§†é¢‘
    videoPaths.forEach(videoPath => {
      command.input(videoPath);
    });
    
    // åˆæˆ
    command
      .on('end', () => {
        console.log('è§†é¢‘åˆæˆå®Œæˆ');
        resolve(outputPath);
      })
      .on('error', (err) => {
        console.error('è§†é¢‘åˆæˆå¤±è´¥:', err);
        reject(err);
      })
      .mergeToFile(outputPath);
  });
}
```

---

### Step 5: æœ€ç»ˆç¡®è®¤ç”Ÿæˆ

ï¼ˆä¿æŒåŸè®¾è®¡ï¼Œå¢åŠ åˆ†æ®µä¿¡æ¯å±•ç¤ºï¼‰

---

## å®Œæ•´æµç¨‹æ€»ç»“

### ä¼˜åŒ–åçš„ç”¨æˆ·æ—…ç¨‹

```
1. ç²˜è´´åŸå§‹æ–‡æ¡ˆ
   â†“
2. AIè‡ªåŠ¨ä¼˜åŒ–ä¸ºå£æ’­ç¨¿
   â€¢ å£è¯­åŒ–æ”¹å†™
   â€¢ æ·»åŠ æ°å½“è¯­æ°”è¯
   â€¢ æ•°å­—è½¬ä¸­æ–‡
   â€¢ æ ‡ç‚¹ç®€åŒ–
   â†“
3. ç”¨æˆ·ç¡®è®¤å¹¶å¯æ‰‹åŠ¨ç¼–è¾‘
   â†“
4. ç”Ÿæˆè¯•å¬éŸ³é¢‘ï¼ˆå‰100å­—ï¼‰
   â€¢ é€‰æ‹©å£°éŸ³ï¼ˆç³»ç»Ÿ/è‡ªå®šä¹‰ï¼‰
   â€¢ è°ƒèŠ‚å‚æ•°
   â€¢ æ’­æ”¾è¯•å¬
   â†“
5. è¯•å¬æ»¡æ„åè¿›å…¥ä¸‹ä¸€æ­¥
   â†“
6. é€‰æ‹©è§†é¢‘æ¨¡æ¿
   â€¢ ç³»ç»Ÿæ¨¡æ¿
   â€¢ è‡ªå®šä¹‰æ¨¡æ¿
   â†“
7. ç³»ç»Ÿåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†æ®µ
   â€¢ çŸ­æ–‡æœ¬ï¼šç›´æ¥ç”Ÿæˆ
   â€¢ é•¿æ–‡æœ¬ï¼šåˆ†æ®µç”Ÿæˆå¹¶è‡ªåŠ¨åˆæˆ
   â†“
8. ç¡®è®¤ç”Ÿæˆ
   â€¢ æ˜¾ç¤ºé¢„è®¡æ¶ˆè€—ç§¯åˆ†
   â€¢ æ˜¾ç¤ºé¢„è®¡è€—æ—¶
   â†“
9. åå°å¤„ç†
   â€¢ ç”Ÿæˆå®Œæ•´TTS
   â€¢ åˆ†æ®µç”Ÿæˆè§†é¢‘
   â€¢ è‡ªåŠ¨åˆæˆ
   â†“
10. å®Œæˆï¼Œå¯ä¸‹è½½
```

---

## æŠ€æœ¯å®ç°è¦ç‚¹

### 1. AIæ–‡æ¡ˆä¼˜åŒ–æœåŠ¡
- ä½¿ç”¨OpenAI GPT-4æˆ–Claude
- ç²¾å¿ƒè®¾è®¡çš„Promptæ¨¡æ¿
- æƒ…æ„Ÿåˆ†æå’Œè¯­æ°”è¯åŒ¹é…
- æ•°å­—è½¬æ¢å’Œæ ‡ç‚¹å¤„ç†

### 2. è¯•å¬é¢„è§ˆæœºåˆ¶
- æå–å‰100å­—ç¬¦
- è°ƒç”¨TTSå¿«é€Ÿç”Ÿæˆï¼ˆ10-30ç§’ï¼‰
- å‰ç«¯éŸ³é¢‘æ’­æ”¾å™¨
- å‚æ•°å®æ—¶è°ƒèŠ‚

### 3. æ™ºèƒ½åˆ†æ®µç®—æ³•
- æŒ‰å¥å­è¾¹ç•Œåˆ†å‰²
- æ§åˆ¶æ¯æ®µ30-60ç§’
- ä¿æŒè¯­ä¹‰å®Œæ•´
- æä¾›å¤šç§ç”Ÿæˆç­–ç•¥

### 4. è§†é¢‘åˆæˆæŠ€æœ¯
- ä½¿ç”¨FFmpegåˆæˆå¤šæ®µè§†é¢‘
- æ— ç¼è¡”æ¥
- éŸ³è§†é¢‘åŒæ­¥
- è¾“å‡ºç»Ÿä¸€æ ¼å¼

### 5. è¿›åº¦ç®¡ç†
- å®æ—¶æ›´æ–°ç”Ÿæˆè¿›åº¦
- æ˜¾ç¤ºå½“å‰å¤„ç†æ®µè½
- é¢„è®¡å‰©ä½™æ—¶é—´
- å¤±è´¥è‡ªåŠ¨é‡è¯•

---

## æ•°æ®åº“æ›´æ–°

### generationsè¡¨æ–°å¢å­—æ®µ

```sql
ALTER TABLE generations ADD COLUMN segmentation_strategy TEXT;
ALTER TABLE generations ADD COLUMN progress INTEGER DEFAULT 0;
ALTER TABLE generations ADD COLUMN segment_count INTEGER;
ALTER TABLE generations ADD COLUMN original_text TEXT;  -- ä¿å­˜åŸå§‹æ–‡æ¡ˆ
```

---

è¿™å°±æ˜¯å®Œæ•´çš„ä¼˜åŒ–è®¾è®¡ï¼ä¸»è¦æ”¹è¿›ï¼š

1. **AIæ–‡æ¡ˆä¼˜åŒ–**ï¼šæ™ºèƒ½æ”¹å†™ï¼Œæ·»åŠ è¯­æ°”è¯ï¼Œæå‡å£æ’­æ•ˆæœ
2. **è¯•å¬ç¡®è®¤**ï¼šå…ˆå¬ç‰‡æ®µï¼Œæ»¡æ„å†ç”Ÿæˆï¼Œé¿å…æµªè´¹
3. **æ™ºèƒ½åˆ†æ®µ**ï¼šé•¿è§†é¢‘è‡ªåŠ¨åˆ†æ®µï¼Œæé«˜æˆåŠŸç‡
4. **çµæ´»ç­–ç•¥**ï¼šå¤šç§ç”Ÿæˆæ–¹æ¡ˆï¼Œç”¨æˆ·å¯é€‰

éœ€è¦æˆ‘è¯¦ç»†è¯´æ˜ä»»ä½•éƒ¨åˆ†å—ï¼Ÿ
